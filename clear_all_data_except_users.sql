-- ============================================
-- Скрипт для удаления всех данных из базы
-- кроме таблицы пользователей (users)
-- ============================================
-- ВНИМАНИЕ: Этот скрипт удалит все данные! 
-- Создайте резервную копию перед использованием!
-- ============================================

SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- 1. КОНФЛИКТЫ И ОПТИМИЗАЦИЯ (самые зависимые)
-- ============================================

TRUNCATE TABLE conflicts;
TRUNCATE TABLE optimization_history;

-- ============================================
-- 2. РАСПИСАНИЕ И ЗАНЯТИЯ
-- ============================================

TRUNCATE TABLE lessons;
TRUNCATE TABLE schedules;

-- ============================================
-- 3. ОГРАНИЧЕНИЯ И НАСТРОЙКИ
-- ============================================

TRUNCATE TABLE constraints;
TRUNCATE TABLE penalty_settings;

-- ============================================
-- 4. УЧЕБНАЯ НАГРУЗКА И ПОДГРУППЫ
-- ============================================

TRUNCATE TABLE teaching_loads;
TRUNCATE TABLE subgroups;

-- ============================================
-- 5. ГРУППЫ И УЧЕБНЫЕ ПЛАНЫ
-- ============================================

TRUNCATE TABLE groups;
TRUNCATE TABLE curricula;

-- ============================================
-- 6. ОБРАЗОВАТЕЛЬНЫЕ ПРОГРАММЫ
-- ============================================

TRUNCATE TABLE educational_programs;

-- ============================================
-- 7. КАФЕДРЫ
-- ============================================

TRUNCATE TABLE departments;

-- ============================================
-- 8. ФАКУЛЬТЕТЫ
-- ============================================

TRUNCATE TABLE faculties;

-- ============================================
-- 9. ДИСЦИПЛИНЫ
-- ============================================

TRUNCATE TABLE disciplines;

-- ============================================
-- 10. СЕМЕСТРЫ
-- ============================================

TRUNCATE TABLE semesters;

-- ============================================
-- 11. РЕСУРСЫ (Аудитории и корпуса)
-- ============================================

TRUNCATE TABLE classrooms;
TRUNCATE TABLE buildings;

-- ============================================
-- 12. ВРЕМЕННЫЕ СЛОТЫ
-- ============================================

TRUNCATE TABLE time_slots;

-- ============================================
-- 13. УВЕДОМЛЕНИЯ
-- ============================================

TRUNCATE TABLE notifications;

-- ============================================
-- ПРИМЕЧАНИЕ: Профили пользователей НЕ удаляются
-- так как они связаны с пользователями через CASCADE
-- и нужны для корректной работы системы
-- ============================================
-- Если вы хотите удалить только данные профилей, раскомментируйте:
-- TRUNCATE TABLE student_profiles;
-- TRUNCATE TABLE teacher_profiles;
-- TRUNCATE TABLE dispatcher_profiles;
-- TRUNCATE TABLE admin_profiles;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- Вывод информации
-- ============================================

SELECT 'Все данные успешно удалены, кроме пользователей!' AS Status;

-- Проверка оставшихся пользователей
SELECT 
    COUNT(*) AS total_users,
    SUM(CASE WHEN role = 'ADMIN' THEN 1 ELSE 0 END) AS admins,
    SUM(CASE WHEN role = 'DISPATCHER' THEN 1 ELSE 0 END) AS dispatchers,
    SUM(CASE WHEN role = 'TEACHER' THEN 1 ELSE 0 END) AS teachers,
    SUM(CASE WHEN role = 'STUDENT' THEN 1 ELSE 0 END) AS students
FROM users;

